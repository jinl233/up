# 进程的描述与控制

## 8、线程的实现

### 线程的实现方式

- 内核支持线程

	- 优点

		- 在多处理器系统中，内核能够同时调度同一进程中的多个线程并发行执行
		- 如果进程中的一个线程被阻塞了，内核可以调度该进程中的其他线程占有处理器运行，也可以运行其他进程中的线程
		- 内核支持线程具有很小的数据结构和堆栈，线程的切换比较快，切换开销小
		- 内核本身也可以采用多线程技术，可以提高系统的执行速度和效率

- 用户级线程
- 组合方式

	- 一对一模型
	- 多对一模型
	- 多对多模型

### 线程的实现

- 内核支持线程的实现
- 用户级线程的实现

	- 实时运行系统
	- 内核控制线程

### 线程的创建和终止

## 7、线程的基本概念

### 线程的引入

- 进程的两个属性

	- 进程是一个可拥有资源的独立的单位
	- 进程又同时的一个可独立调度和分派的基本单位

- 程序并发执行所需付出的时空开销

	- 创建进程
	- 撤销进程
	- 进程切换  

- 线程——作为调度和分派的基本单位

### 线程与进程的比较

- 调度的基本单位
- 并发性
- 拥有资源
- 独立性
- 系统开销
- 支持多处理机系统

### 线程的状态和线程控制块

- 线程运行的三个状态

	- 执行状态
	- 就绪状态
	- 阻塞状态

- 线程控制块TCB

	- 线程标识符
	- 一组寄存器
	- 线程运行状态
	- 优先级
	- 线程专有存储区
	- 信号屏蔽
	- 堆栈指针

- 多线程OS中的进程属性

	- 进程是一个可拥有资源的基本单位
	- 多个线程可并发执行
	- 进程不是可执行的实体

## 1、前趋图和程序执行

### 前趋图

- 有向无循环图，每个节点表示一个进程或程序段或一条语句，节点间的有向边表示两个节点间的偏序关系或前趋关系

### 程序顺序执行

- 程序的顺序执行
- 程序顺序执行的特征

	- 顺序性
	- 封闭性
	- 可再现性

### 程序并发执行

- 程序的并发执行
- 程序并发执行的特征

	- 间断性
	- 失去封闭性
	- 不可再现性

## 2、进程的描述

### 进程的定义和特征

- 定义

	- 进程实体

		- 程序段
		- 相关数据段
		- 数据结构-PCB

	- 进程是程序的一次执行
	- 进程是一个程序及其数据在处理机上顺序执行时所发生的活动
	- 进程是具有独立功能的程序在一个数据集合上运行的过程，它是系统进行资源分配和调度的一个独立单位

- 特征

	- 动态性

		- 由创建而产生，由调度而执行，由撤销而消亡

	- 并发性

		- 是进程的重要特征，也是OS的重要特征

	- 独立性

		- 进程实体是一个能独立运行、独立获得资源、独立接受调度的基本单位

	- 异步性

		- 按各自独立、不可预知的速度向前推进

### 进程的基本状态和转换

- 三种基本状态

	- 就绪状态
	- 执行状态
	- 阻塞状态

- 三种基本状态的转换

	- ————>

- 创建状态和终止状态

	- 创建状态
	- 终止状态

### 挂起操作和进程状态的转换

- 挂起操作的引入

	- 终端用户的需求
	- 父进程请求
	- 负荷调节的需要
	- 操作系统的需要

- 引入挂起原语操作后三个进程状态的转换

	- 活动就绪->静止就绪
	- 活动阻塞->静止阻塞
	- 静止就绪->活动就绪
	- 静止就绪->活动阻塞

- 引入挂起操作后的五个进程状态的转换

### 进程管理中的数据结构

- 操作系统中用于管理控制的数据结构

	- 内存表
	- 设备表
	- 文件表
	- 用于进程管理的进程表

- 进程控制块PCB的作用

	- 作为独立运行基本单位的标志
	- 能实现间断性运行方式
	- 提供进程管理所需要的信息
	- 提供进程调度所需要的信息
	- 实现与其它进程的同步与通信

- 进程控制块中的信息

	- 进程标识符

		- 外部标识符
		- 内部标识符

	- 处理机状态

		- 通用寄存器
		- 指令计数器
		- 程序状态
		- 用户栈指针

	- 进程调度信息

		- 进程状态
		- 进程优先级
		- 进程调度所需要的信息
		- 事件

	- 进程控制信息

		- 程序和数据的地址
		- 进程同步和通信机制
		- 资源清单
		- 链接指针

- 进程控制块中的组织方式

	- 线性方式
	- 链接方式
	- 索引方式

## 3、进程控制

### 操作系统内核

- 支撑功能

	- 中断处理
	- 时钟管理
	- 原语操作

- 资源管理功能

	- 进程管理
	- 存储器管理
	- 设备管理

### 进程的创建

- 进程的层次结构
- 进程图
- 引起创建进程的事件

	- 用户登录
	- 作业调度
	- 提供服务
	- 应用请求

- 进程的创建

	- 申请空白PCB
	- 为新进程分配其所运行所需的资源
	- 初始化进程控制块PCB
	- 如果就绪队列能够接纳新进程，便将新进程插入就绪队列

### 进程的终止

- 引起进程终止的事件

	- 正常结束
	- 异常结束
	- 外界干预

- 进程的终止过程

	- 根据被终止进程的标识符，从PCB集合中检索出该进程的PCB，从中读取该进程的状态
	- 若被终止进程正处于执行状态，应立即终止该进程的执行，并置调度状态为真，用于指示该进程被终止后应重新进行调度
	- 若该进程还有子孙进程，还应将其所有子孙进程也予以终止，以防止它们成为不可控的进程
	- 将被终止进程所拥有的全部资源归还给父进程或者系统
	- 将被终止进程（PCB）从所在队列（或链表）中移出，等待其他程序来搜集信息

### 进程的阻塞和唤醒

- 引起进程阻塞和唤醒的事件

	- 向系统请求共享资源失败
	- 等待某种操作的完成
	- 新数据尚未到达
	- 等待新任务的到达

- 进程阻塞过程
- 进程唤醒过程

### 进程的挂起与激活

- 进程的挂起
- 进程的激活过程

## 4、进程同步

### 进程同步的基本概念

- 两种形式的制约关系

	- 间接相互制约关系

		- 多个程序共享系统资源
		- 多个进程为完成同一任务相互合作

	- 直接相互制约关系

- 临界资源
- 临界区

	- 每个进程中访问临界资源的那段代码成为临界区

- 同步机制应遵循的规则

	- 空闲让等
	- 忙则等闲
	- 有限等待
	- 让权等待

### 硬件同步机制

- 关中断
- 利用Test-and-Set指令实现互斥
- 利用Swap指令实现互斥

### 信号量机制

- 整型信号量
- 记录型信号量
- AND型信号量
- 信号量集

### 信号量的应用

- 利用信号量实现进程互斥
- 利用信号量实现前趋关系

### 管程机制

- 管程的定义
- 条件变量

## 5、经典进程的同步问题

### 生产者-消费者问题

- 利用记录型信号量解决生产者-消费者问题
- 利用AND信号量解决生产者-消费者问题
- 利用管程解决生产者-消费者问题

### 哲学家进餐问题

- 利用记录型信号量解决哲学家进餐问题
- 利用AND信号量解决哲学家进餐问题

### 读者-写者问题

- 利用记录型信号量解决读者-写者问题
- 利用AND信号量解决读者-写者问题

## 6、进程通信

### 进程通信的类型

- 共享存储器系统

	- 基于共享数据结构的通信方式
	- 基于共享存储区的通信方式

- 管道（pipe）通信系统
- 消息传递系统

### 消息传递通信的实现方式

- 直接消息传递系统

	- 直接通信原语

		- 对称寻址方式
		- 非对称寻址方式

	- 消息的格式
	- 进程的同步方式
	- 通信链路

- 信箱通信

	- 信箱的结构

		- 信箱的结构
		- 信箱体

	- 信箱通信原语

		- 邮箱的创建和撤销
		- 消息的发送和接收

	- 信箱的类型

		- 私用邮箱
		- 公用邮箱
		- 共享邮箱

			- 一对一关系
			- 多对一关系
			- 一对多关系
			- 多对多关系

### 直接消息传递系统实例

- 消息缓冲队列通信机制中的数据结构

	- 消息缓冲区
	- PCB中有关通信的数据项

- 发送原语
- 接收原语

## 阻塞

## 就绪

## 终止

## 执行
 